---
title: 拉格朗日对偶性
tags:
  - machine_leanring
  - math
categories:
  - machine_leanring
mathjax: true
date: 2018-05-02 15:47:57
---


# 预备知识
## 凸集
首先是凸集，这个的几何意义如图所示，指集合中任意两点间的线段永远在集合中的集合。
![图3](/images/计算/凸集.jpg)

你可以看到，左图中任意两点，它们的线段一定会在C这个集合中，所以它就是一个凸集，但是对于右图而言，其线段就可能会有部分不在集合中，因此它不是凸集。

如果我们用数学定义来描述凸集的话，它是指这样的一个集合$C$：对任意$x,y \in C, \lambda \in R, 0 \leq \lambda \leq 1$，都有
$$\lambda x + (1-\lambda)y \in C \tag{1}$$

常见的凸集有：
> n维实数空间； 一些范数约束形式的集合； 仿射子空间； 凸集的交集； n维半正定矩阵集。


## 凸函数
那么知道凸集是什么意思后，让我们看看凸函数。
凸函数的几何意义是，函数任意两点(x, y)连线上的值一定大于对应自变量区(x, y)间内的函数值(f(x),f(y))，示例图如下：
![图4](/images/计算/凸函数.jpg)

你可以看到，将xy连接起来的直线上的值，一定大于xy两点范围内的函数值$f(x)$

如果我们用数学定义来描述凸函数的话，凸函数$f(x)$是这样的一个函数：定义域为凸集$D(f)$，且对于任意$x,y \in D(f),\lambda \in R, 0 \leq \lambda \leq 1$，有
$$f(\lambda x + (1-\lambda)y) \leq \lambda f(x) + (1-\lambda)f(y) \tag{2}$$

常见的凸函数有:
> 指数函数族；非负对数函数；仿射函数；二次函数；常见的范数函数；凸函数非负加权的和等。

##凸优化问题

讲解完凸集和凸函数的定义，终于到凸优化问题了。
凸优化问题，实际上就是研究定义于凸集中的凸函数最小化问题。
正式的说，凸优化问题在优化问题中的形式是这样的
$$\min \ f(x), \ \ s.t. x \in C \tag{3}$$
其中$f$是一个凸函数，$C$为凸集，$x$是优化变量。
因为上面这个表达还是有些含糊，所以凸优化问题我们更常用这个形式来表示它
$$\min \ f(x), \ \ s.t. g_i(x) \leq 0, i = 1,...,m, h_i(x) = 0, i = 1,...,m \tag{4}$$
其中$f$是一个凸函数，$g_i$是一个凸函数, $h_i$为仿射函数，$x$是优化变量。

常见的凸优化问题有:
> 线性规划、二次规划、二次约束的二次规划、半正定规划。

# 二次规划
二次规划（Quadratic Programming，简称QP）是一类典型的优化问题，包括凸二次规划和非凸二次优化。在此类问题中，目标函数是变量的二次函数，而约束条件是变量的线性不等式。
假定变量个数为$d$，约束条件的个数是$m$，则标准的二次规划问题形如
$$min_x \frac{1}{2} x^TQx + c^Tx,\ s.t. Ax \leq b \tag{5}$$
其中$x$为$d$维向量，$ Q\in R^{d \times d}$为实对称矩阵，$ A \in R^{m \times d}$为实矩阵，$b \in R^m$和$c \in R^d$为实向量，$Ax \leq b$的每一行对应一个约束。


## 拉格朗日乘子法
拉格朗日乘子法（Largrange multipliers）是一种寻找多元函数在一组约束下的极值的方法。通过引入拉格朗日乘子，可将有$d$个变量与$k$个约束条件的最优化问题转化为具有$d+k$个变量的无约束优化问题求解。
这样说你可能会觉得很抽象，那么让我们先举一个稍微简单一点的例子。

### 等式约束的优化问题
先考虑一个等式约束的优化问题，假定$x$为$d$维向量，我们想要寻找$x$的某个取值$x^*$，使得目标函数$f(x)$最小且同时满足$g(x)=0$的约束。从几何角度看，这个问题的目标是在方程$g(x)=0$确定的$d-1$维曲面上寻找能使目标函数最小化的点。如图所示
![图4](/images/计算/拉格朗日乘子.jpg)

通过上面的描述，我们不难得到如下结论：
对于约束曲面上的任意点$x$，该点的梯度$\nabla g(x)$正交于约束曲面；
在最优点$x^*$，目标函数在该点的梯度$\nabla f(x^*)$正交于约束曲面；

由此可知，在最优点$x^*$，如上图所示，梯度$\nabla g(x)$和$\nabla f(x)$的方向必相同或相反，即存在$\lambda \neq 0$($\lambda$称为拉格朗日乘子)使得
$$\nabla f(x^*) + \lambda \nabla g(x^*) = 0 \tag{6}$$
基于上面这个式子，我们可以定义拉格朗日函数
$$L(x,\lambda) = f(x) + \lambda g(x) \tag{7}$$

你可能会疑惑，为什么拉格朗日函数会是这个样子。那么让我们对这个函数进行求导看看：
当$L(x,\lambda)$对$x$求导时：(因为要求最优解，所以我们需要置$\nabla_x L(x, \lambda)$为0)
$$\nabla_x L(x, \lambda) = \nabla f(x) + \lambda \nabla g(x) = 0 \tag{8}$$
当$L(x,\lambda)$对$\lambda$求导时：（我们同样置$\nabla_{\lambda} L(x, \lambda)$为0）
$$\nabla_{\lambda} L(x, \lambda) = 0 + g(x) = 0 \tag{9}$$

注意，在一开始，我们的目标是寻找$x$的某个取值$x^*$，使得目标函数$f(x)$最小且同时满足$g(x)=0$的约束。
那么通过拉格朗日函数的两次对不同变量的求导，你可以发现
式(8) = 式(6)，这是为了使得目标函数$f(x)$最小
    式(9) = 约束条件$g(x)=0$，这是为了满足约束条件

因此，原约束优化问题就转化为了对拉格朗日函数$L(x, \lambda)$的无约束优化问题。

### 不等式约束的优化问题

现在考虑不等式约束$g(x) \leq 0$，如图4所示，此时最优点$x^*$要么在$g(x) < 0 $的区域里，要么在边界$g(x) = 0$上。
![图4](/images/计算/拉格朗日乘子.jpg)

对于$g(x)<0$的情形，约束$g(x) \leq 0$不起作用，可直接通过条件$\nabla f(x)=0$来获得最优点，这等价于将$\lambda$置0，然后对$\nabla_x L(x, \lambda)$置0得到最优点
对于$g(x)=0$的情形，类似于上面我们对等式约束的分析，但需注意的是，此时$\nabla f(x^*)$的方向必与$\nabla g(x^*)$相反，即存在常数$\lambda > 0$使得$\nabla f(x^*) + \lambda \nabla g(x^*) = 0$

对上面描述的两种情况进行整合，在约束$g(x) \leq 0$下最小化$f(x)$的任务，可以转化为在如下约束下最小化$L(x,\lambda) = f(x) + \lambda g(x)$的任务：
$$\begin{cases}g(x) \leq 0\\ \lambda \geq 0\\ \lambda_j g_j(x) = 0\end{cases} \tag{10}$$

式(2.10)就是大名鼎鼎的Karush-Kuhn-Tucker（简称KKT）条件。
多个约束条件的优化问题

在对等式约束优化问题和不等式约束优化问题进行讲解后，我们可以将其推广到多个约束。
考虑具有$m$个等式约束和$n$个不等式约束，且可行域$D \subset R^d$非空的优化问题
$$min_x \ f(x),\ \ s.t. \ h_i(x)=0 \ (i = 1,...,m), \ g_j(x) \leq 0 \ (j = 1,...,m) \tag{11}$$
引入拉格朗日乘子$\lambda = (\lambda_1, \lambda_2, ..., \lambda_m)^T$和$\mu = (\mu_1,\mu_2,...,\mu_n)^T$，相应的拉格朗日函数为
$$L(x,\lambda, \mu) = f(x) + \sum_{i=1}^m \lambda_i h_i(x) +\sum_{j=1}^n \mu_j g_j(x) \tag{12}$$
由不等式约束引入的KKT条件(j=1,2,...,n)为
$$\begin{cases}g_j(x) \leq 0\\ \mu_j \geq 0\\ \mu_j g_j(x) = 0\end{cases} \tag{13}$$

## 对偶问题

前面我们说过，一个优化问题可以从两个角度来考虑，即主问题(primal problem)和对偶问题(dual problem)。在约束最优化问题中，常常利用拉格朗日对偶性将原始问题（主问题）转换成对偶问题，通过解对偶问题来得到原始问题的解。这样做是因为对偶问题的复杂度往往低于主问题。

### 多约束对偶问题
多约束对偶问题的通用解

多约束对偶问题的主问题:
$$min_x \ f(x),\ \ s.t. \ h_i(x)=0 \ (i = 1,...,m), \ g_j(x) \leq 0 \ (j = 1,...,m) \tag{11}$$
其相应的拉格朗日函数为
$$L(x,\lambda, \mu) = f(x) + \sum_{i=1}^m \lambda_i h_i(x) +\sum_{j=1}^n \mu_j g_j(x) \tag{12}$$

基于(12)，对主问题(11)的拉格朗日对偶函数$\Gamma: R^m \cdot R^n \rightarrow R$定义为
$$\Gamma(\lambda,\mu) = inf_{x \in D} L(x,\lambda,\mu) = inf_{x \in D} (f(x) + \sum_{i=1}^m \lambda_i h_i(x) +\sum_{j=1}^n \mu_j g_j(x)) \tag{13}$$
若$\tilde{x} \in D$为主问题(11)可行域中的点，则对任意$\mu \geq 0$和$\lambda$都有
$$\sum_{i=1}^m \lambda_i h_i(x) + \sum_{j=1}^n \mu_j g_j(x) \leq 0 \tag{14}$$
进而有
$$\Gamma(\lambda,\mu) = inf_{x \in D} L(x,\lambda,\mu) \leq L(\tilde{x},\lambda,\mu) \leq f(\tilde{x}) \tag{15}$$

若主问题(2.11)的最优值为$p^*$，则对任意$\mu \geq 0$和$\lambda$都有
$$\Gamma(\lambda,\mu) \leq p^* \tag{3.4}$$
即对偶函数给出了主问题最优值的下界。显然，这个下界取决于$\mu$和$\lambda$的值。于是一个很自然的问题就是：基于对偶函数能获得的最好下界是什么？这就引出了优化问题
$$max_{\lambda, \mu} \Gamma(\lambda, \mu) \ \ s.t. \mu \geq 0 \tag{16}$$

式(16)就是主问题（11）的对偶问题，其中$\mu$和$\lambda$称为**对偶变量（dual variable）**。无论主问题（11）的凸性如何，对偶问题（16）始终是凸优化问题。

考虑式(16)的最优值$d^*$，显然有$d^* \leq p^*$，这称为**“弱对偶性(weak duality)”**成立；

若$d^* = p^*$，则称为**“强对偶性（strong duality）”**成立，此时由对偶问题能获得主问题的最优下界；

对于一般的优化问题，强对偶性通常不成立，但是若主问题是凸优化问题，如式(11)中$f(x)$和$g_j(x)$均为凸函数，$h_i(x)$为仿射函数，且其可行域中至少有一点使不等式约束严格成立，则此时强对偶性成立。

P.S. 在强对偶性成立时，将拉格朗日函数分别对元变量和对偶变量求导，再同时令导数等于0，即可得到原变量与对偶变量的数值关系。
于是对偶问题解决了，主问题也就解决了。



## 参考资料
> 《统计学习方法》李航 著  清华大学出版社


